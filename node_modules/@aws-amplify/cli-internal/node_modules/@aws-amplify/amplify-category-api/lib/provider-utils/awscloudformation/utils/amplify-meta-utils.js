"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.getAppSyncResourceName = exports.getAppSyncAuthConfig = exports.checkIfAuthExists = exports.authConfigHasApiKey = void 0;
const amplify_cli_core_1 = require("amplify-cli-core");
const authConfigHasApiKey = (authConfig) => {
    if (!authConfig) {
        return false;
    }
    return (Array.of(authConfig.defaultAuthentication)
        .concat(authConfig.additionalAuthenticationProviders)
        .filter(auth => !!auth)
        .map(auth => auth.authenticationType)
        .findIndex(authType => authType === 'API_KEY') > -1);
};
exports.authConfigHasApiKey = authConfigHasApiKey;
const checkIfAuthExists = () => {
    const amplifyMeta = amplify_cli_core_1.stateManager.getMeta();
    let authResourceName;
    const authServiceName = amplify_cli_core_1.AmplifySupportedService.COGNITO;
    const authCategoryName = amplify_cli_core_1.AmplifyCategories.AUTH;
    if (amplifyMeta[authCategoryName] && Object.keys(amplifyMeta[authCategoryName]).length > 0) {
        const categoryResources = amplifyMeta[authCategoryName];
        Object.keys(categoryResources).forEach(resource => {
            if (categoryResources[resource].service === authServiceName) {
                authResourceName = resource;
            }
        });
    }
    return authResourceName;
};
exports.checkIfAuthExists = checkIfAuthExists;
const getAppSyncAuthConfig = (projectMeta) => {
    const entry = getAppSyncAmplifyMetaEntry(projectMeta);
    if (entry) {
        const value = entry[1];
        return value && value.output ? value.output.authConfig : {};
    }
};
exports.getAppSyncAuthConfig = getAppSyncAuthConfig;
const getAppSyncResourceName = (projectMeta) => {
    const entry = getAppSyncAmplifyMetaEntry(projectMeta);
    if (entry) {
        return entry[0];
    }
};
exports.getAppSyncResourceName = getAppSyncResourceName;
const getAppSyncAmplifyMetaEntry = (projectMeta) => {
    return Object.entries(projectMeta[amplify_cli_core_1.AmplifyCategories.API] || {}).find(([, value]) => value.service === amplify_cli_core_1.AmplifySupportedService.APPSYNC);
};
//# sourceMappingURL=amplify-meta-utils.js.map